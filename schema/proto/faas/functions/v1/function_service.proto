syntax = "proto3";

package faas.functions.v1;

option go_package = "github.com/10Narratives/faas/pkg/faas/functions/v1;functionspb";

//
service FunctionService {
  //
  rpc UploadFunctionSource(stream UploadFunctionSourceRequest)
  returns (UploadFunctionSourceResponse);
}

message UploadFunctionSourceRequest {
  oneof payload {
    UploadFunctionSourceMetadata metadata = 1;
    UploadChunk chunk = 2;
  }
}

message UploadFunctionSourceMetadata {
  string function_name = 1;
  SourceBundleMetadata source_bundle_metadata = 2;
}

enum SourceBundleType {
  SOURCE_BUNDLE_TYPE_UNSPECIFIED = 0;
  SOURCE_BUNDLE_TYPE_ZIP = 1;
}

message SourceBundleMetadata {
  SourceBundleType type = 1;
  string file_name = 2;
  uint64 size = 3;
}

message UploadChunk {
  bytes data = 1;
}

message UploadFunctionSourceResponse {
  string function_id = 1;
  string object_key = 2;
}
